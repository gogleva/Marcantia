mutate(species = 'Niben')
deg_nb_mp <- rbind(mp_deg_all,
nb_deg_all)
single_copy_OG <- read_tsv('data/SingleCopyOrthogroups.txt',
col_names = FALSE)
names(single_copy_OG) <- 'OG'
orthogroups <- read_delim('data/Orthogroups.csv',
delim = '\t')
names(orthogroups) <- c('OG', 'Mpoly', 'Niben')
scp_og <- left_join(single_copy_OG, orthogroups) %>%
separate(Mpoly, '\\.', into = c('Mpoly',
'the_rest')) %>%
separate(Niben, '\\.', into = c('Niben', 'stuff')) %>% select(-c(the_rest, stuff)) %>%
gather(Mpoly, Niben, key = 'species', value = 'gene_id')
ogdeg <- left_join(scp_og, deg_nb_mp)
plotdat_mp <- select(ogdeg, c(species, OG, gene_id,
day_time, log2FoldChange)) %>%
filter(species == 'Mpoly') %>%
select(-species) %>%
rename(log2FoldChange = 'mp_lfc',
gene_id = 'MP_gene_id')
plotdat_nb <- select(ogdeg, c(species, OG, gene_id,
day_time, log2FoldChange)) %>%
filter(species == 'Niben') %>%
select(-species) %>%
rename(log2FoldChange = 'nb_lfc',
gene_id = 'NB_gene_id')
plotdat_mp_nb <- left_join(plotdat_mp, plotdat_nb) %>%
filter(!is.na(mp_lfc) & !is.na(nb_lfc))
ggplot(plotdat_mp_nb, aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(alpha = 0.5)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
facet_wrap(~ day_time)
intstall.packages('ggpmisc')
install.packages('ggpmisc')
install.packages("ggpmisc")
library("ggpmisc")
mp_annotation <- read_csv("data/Mpolymorpha_tidy_annotation.csv")
names(mp_annotation)[1] <- 'MP_gene_id'
plotdat_mp_nb_annotated <- left_join(plotdat_mp_nb, mp_annotation)
ggplot(plotdat_mp_nb_annotated, aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
facet_wrap(~day_time)
plotdat_mp_nb_annotated %>%
filter(!is.na(type)) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
facet_wrap(~day_time)
plotdat_mp_nb_annotated %>%
arrange(!is.na(type), type) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
facet_wrap(~day_time) +
xlab('LFC N. benthamiana') +
ylab('LFC M. polymorpha') +
theme_bw()
plotdat_mp_nb_annotated %>%
arrange(!is.na(type), type) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
stat_quadrant_counts(colour = 'red')
plotdat_mp_nb_annotated %>%
arrange(!is.na(type), type) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
stat_quadrant_counts(colour = 'red') +
facet_wrap(~day_time) +
xlab('LFC N. benthamiana') +
ylab('LFC M. polymorpha') +
theme_bw()
plotdat_mp_nb_annotated %>%
arrange(!is.na(type), type) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
stat_quadrant_counts(colour = 'blue') +
facet_wrap(~day_time) +
xlab('LFC N. benthamiana') +
ylab('LFC M. polymorpha') +
theme_bw()
plotdat_mp_nb_annotated %>%
arrange(!is.na(type), type) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
stat_quadrant_counts(colour = 'black') +
facet_wrap(~day_time) +
xlab('LFC N. benthamiana') +
ylab('LFC M. polymorpha') +
theme_bw()
?stat_quadrat_counts
?stat_quadrant_counts
mp_sc_og <- plotdat_mp_nb_annotated %>%
filter(!is.na(type)) %>%
pull(MP_gene_id)
mp_sc_og
nums_both %>%
select(c(OG_id, n_Mpoly, n_Niben)) %>%
unique() %>%
ggplot(aes(x = n_Niben, y = n_Mpoly, color = factor(n_Mpoly))) +
geom_jitter(aes(alpha = 0.1)) +
xlim(c(0,10)) +
ylim(c(0,10)) +
theme(legend.position = 'none')
all_og <- read_delim("data/Orthogroups.txt",
delim = ':',
col_names = FALSE)
names(all_og) <- c('OG_id', 'genes')
all_og <- all_og %>%
mutate(genes = str_split(genes, pattern = ' ')) %>%
unnest(genes) %>%
filter(genes != "") %>%
separate(genes, into = c('gene_id', 'the_rest')) %>%
select(-the_rest)
nums_mp <- all_og %>%
filter(grepl('Mapoly', gene_id)) %>%
group_by(OG_id) %>%
add_count(OG_id) %>%
ungroup()
nums_nb <- all_og %>%
group_by(OG_id) %>%
filter(grepl('Niben', gene_id)) %>%
add_count(OG_id) %>%
ungroup()
nums_both <- full_join(nums_mp, nums_nb, by = 'OG_id') %>%
rename('n.x' = 'n_Mpoly',
'n.y' = 'n_Niben') %>%
mutate(n_Mpoly = replace_na(n_Mpoly,0),
n_Niben = replace_na(n_Niben,0))
nums_both %>%
select(c(OG_id, n_Mpoly, n_Niben)) %>%
unique() %>%
ggplot(aes(x = n_Niben, y = n_Mpoly, color = factor(n_Mpoly))) +
geom_jitter(aes(alpha = 0.1)) +
xlim(c(0,10)) +
ylim(c(0,10)) +
theme(legend.position = 'none')
ggplot(nums_both, aes(x = n_Niben, y = n_Mpoly, color = as.factor(n_Mpoly))) +
geom_jitter(aes(alpha = 0.1)) +
xlim(c(0,10)) +
ylim(c(0,10)) +
theme(legend.position = 'none')
og_flav <- nums_both %>%
rename('gene_id.x' = 'MP_gene_id') %>%
full_join(mp_annotation) %>%
filter(type == 'flavonoid pathway')
View(og_flav)
unique(og_flav$OG_id)
length(unique(og_flav$OG_id))
nums_both %>%
select(c(OG_id, n_Mpoly, n_Niben)) %>%
unique() %>%
ggplot(aes(x = n_Niben, y = n_Mpoly, color = factor(n_Mpoly))) +
geom_jitter(aes(alpha = 0.1)) +
xlim(c(0,10)) +
ylim(c(0,10)) +
theme(legend.position = 'none')
View(nums_both)
View(og_flav)
og_flav %>%
filter(n_Mpoly == 1 & n_Niben == 1)
View(og_flav %>%
filter(n_Mpoly == 1 & n_Niben == 1))
View(og_flav %>%
filter(n_Mpoly == 1 & n_Niben == 1))
mat <- read.csv("/home/anna/anna/Labjournal/Manuscripts/marchantia_II_plant_response/analysis/Heatmaps_based_on_Bowman_tidy/DEGmat_1916.csv", row.names = 1)
mat
View(mat)
View(mat)
mat
mp_dds <- DESeqDataSetFromMatrix(countData = mp_fc_matrix,
colData = mp_coldata,
design = ~ Experiment)
mp_vsd <- vst(mp_dds, blind = FALSE) # variance-stabilised counts
plotdat_mp_nb_annotated %>%
arrange(!is.na(type), type) %>%
ggplot(aes(x = nb_lfc, y = mp_lfc)) +
geom_point(aes(color = type)) +
geom_vline(xintercept = 0) +
geom_hline(yintercept = 0)  +
stat_quadrant_counts(colour = 'black') +
facet_wrap(~day_time) +
xlab('LFC N. benthamiana') +
ylab('LFC M. polymorpha') +
theme_bw()
mp_sc_og <- plotdat_mp_nb_annotated %>%
filter(!is.na(type)) %>%
pull(MP_gene_id)
mp_sc_og
mp_dds <- DESeqDataSetFromMatrix(countData = mp_fc_matrix,
colData = mp_coldata,
design = ~ Experiment)
mp_vsd <- vst(mp_dds, blind = FALSE) # variance-stabilised counts
mp_vsd <- as.data.frame(assay(mp_vsd)) %>%
mutate(id = rownames(mp_vsd))
mp_DEG_sc <- filter(mp_vsd, id %in% mp_sc_og) %>%
select(id, everything())
rownames(mp_DEG_sc) <- mp_DEG_sc$id
mp_DEG_sc <- select(mp_DEG_sc, -id)
mp_DEGmat_sc <- mp_DEG_sc - rowMeans(mp_DEG_sc)
anno <- as.data.frame(colData(mp_dds)[, c('Time', 'Experiment')])
pheatmap(mp_DEGmat_sc, cluster_cols = FALSE,
show_rownames = FALSE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno)
mp_DEGmat_sc
rownames(mp_DEGmat_sc)
og_flav
mp_DEGmat_sc %>%
filter(rowmnames(mp_DEGmat_sc) %in% og_flav$MP_gene_id) %>%
pheatmap(cluster_cols = FALSE,
show_rownames = FALSE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno)
mp_DEGmat_sc %>%
filter(rownames(mp_DEGmat_sc) %in% og_flav$MP_gene_id) %>%
pheatmap(cluster_cols = FALSE,
show_rownames = FALSE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno)
mp_DEGmat_sc %>%
filter(rownames(mp_DEGmat_sc) %in% og_flav$MP_gene_id) %>%
pheatmap(cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8)
View(mp_DEGmat_sc %>%
filter(rownames(mp_DEGmat_sc) %in% og_flav$MP_gene_id))
mp_DEGmat_sc[rownames(mp_DEGmat_sc) %in% og_flav$MP_gene_id,]
mp_DEGmat_sc_flav <- mp_DEGmat_sc[rownames(mp_DEGmat_sc) %in% og_flav$MP_gene_id,]
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8)
View(plotdat_mp_nb_annotated)
mp_DEGmat_sc_flav
mp_annotation
rownames(mp_DEGmat_sc)
an_flav <- data.frame(row.names = rownames(mp_DEGmat_sc_flav), descr = 1 )
an_flav <- data.frame(row.names = rownames(mp_DEGmat_sc_flav))
an_flav
View(an_flav)
mp_annotation
an_flav <- data.frame(row.names = rownames(mp_DEGmat_sc_flav), MP_gene_id = rownames(mp_DEGmat_sc_flav))
left_join(ann_flav, mp_annotation)
left_join(an_flav, mp_annotation)
an_flav <- data.frame(row.names = rownames(mp_DEGmat_sc_flav), MP_gene_id = rownames(mp_DEGmat_sc_flav))
an_flav <- left_join(an_flav, mp_annotation) %>%
select(c(MP_gene_id, description))
View(an_flav)
rownames(an_flav) <- an_flav$MP_gene_id
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8)
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
gaps_row = cumsum(rle(as.character(an_flav$description))$lengths),
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8)
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
gaps_row = cumsum(rle(as.character(an_flav$description))$lengths),
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12))
cumsum(rle(as.character(an_flav$description))$lengths
)
cumsum(rle(as.character(an_flav$description))$lengths
)
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
gaps_row = cumsum(rle(as.character(an_flav$description))$lengths),
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12))
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav$description,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12))
ann_flav[-c(MP_gene_id)]
an_flav[-c(MP_gene_id)]
an_flav[-c('MP_gene_id')]
an_flav[-c('MP_gene_id'),]
an_flav[-'MP_gene_id']
ann_flav
an_flav
View(an_flav)
an_flav[1]
an_flav[-1]
ann_flav <- ann_flav[-1]
ann_flav <- an_flav[-1]
an_flav <- an_flav[-1]
View(an_flav)
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12))
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12))
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12))
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_row = c(1,2),
gaps_col=c(12))
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_row = c(2),
gaps_col=c(12))
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway')
library(RColorBrewer)
brewer.pal(9, 'Paired')
?pheatmap
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway')
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
gaps_row = c(2,4,6),
main = 'flavonoid pathway')
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway')
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = TRUE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway')
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway')
an_flav$description
my_cols <- list(description = row_cols)
row_cols <- brewer.pal(9, 'Paired')
my_cols <- list(description = row_cols)
my_cols
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = FALSE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway',
annotation_colors = my_cols)
my_cols
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = TRUE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway',
annotation_colors = my_cols)
pheatmap(mp_DEGmat_sc_flav,
cluster_cols = FALSE,
cluster_rows = TRUE,
show_rownames = TRUE,
color = colorRampPalette(c("navy", "white", "#1B9E77"))(50),
annotation = anno,
annotation_row = an_flav,
cellheight = 7, cellwidth = 7,
fontsize_row = 8,
fontsize_col = 8,
gaps_col=c(12),
main = 'flavonoid pathway')
View(mp_DEGmat_sc_flav)
